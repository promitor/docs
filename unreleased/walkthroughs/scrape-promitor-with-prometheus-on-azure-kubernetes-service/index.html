
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Bringing Azure Monitor metrics where you need them">
      
      
        <meta name="author" content="Tom Kerkhove">
      
      
        <link rel="canonical" href="https://promitor.io/unreleased/walkthroughs/scrape-promitor-with-prometheus-on-azure-kubernetes-service/">
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.9">
    
    
      
        <title>Deploying Promitor, Prometheus, and Grafana on an AKS Cluster - Promitor - Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.120efc48.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-Q2ZZ6S7ZPW"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-Q2ZZ6S7ZPW",{page_path:e.pathname})})})</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q2ZZ6S7ZPW"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deploying-promitor-prometheus-and-grafana-on-an-aks-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Promitor - Documentation" class="md-header__button md-logo" aria-label="Promitor - Documentation" data-md-component="logo">
      
  <img src="../../media/logos/promitor-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Promitor - Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deploying Promitor, Prometheus, and Grafana on an AKS Cluster
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/promitor/docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    promitor/docs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../how-it-works/" class="md-tabs__link">
      How It Works
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../metrics/general-declaration/" class="md-tabs__link">
        Metrics
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../deployment/" class="md-tabs__link">
        Deployment
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../configuration/v2.x/runtime/scraper/" class="md-tabs__link">
        Configuration
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../security/azure-authentication/" class="md-tabs__link">
        Security
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../operations/" class="md-tabs__link">
        Operations
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        Walkthroughs
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../faq/" class="md-tabs__link">
      FAQ
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Promitor - Documentation" class="md-nav__button md-logo" aria-label="Promitor - Documentation" data-md-component="logo">
      
  <img src="../../media/logos/promitor-logo.svg" alt="logo">

    </a>
    Promitor - Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/promitor/docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    promitor/docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../how-it-works/" class="md-nav__link">
        How It Works
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Metrics" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Metrics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metrics/general-declaration/" class="md-nav__link">
        General Declaration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metrics/supported-providers/" class="md-nav__link">
        Supported Providers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../metrics/labels/" class="md-nav__link">
        What labels do we provide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" data-md-state="indeterminate" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../deployment/">Deployment</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" data-md-state="indeterminate" type="checkbox" id="__nav_4_2" checked>
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../deployment/scraper/">Scraper</a>
          
            <label for="__nav_4_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Scraper" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Scraper
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/scraper/docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/scraper/kubernetes/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" data-md-state="indeterminate" type="checkbox" id="__nav_4_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../deployment/resource-discovery/">Resource Discovery</a>
          
            <label for="__nav_4_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Resource Discovery" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Resource Discovery
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/resource-discovery/docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/resource-discovery/kubernetes/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" data-md-state="indeterminate" type="checkbox" id="__nav_5" checked>
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Configuration" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/v2.x/runtime/scraper/" class="md-nav__link">
        scraper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/v2.x/runtime/resource-discovery/" class="md-nav__link">
        resource-discovery
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" data-md-state="indeterminate" type="checkbox" id="__nav_6" checked>
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6">
          Security
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Security" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Security
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../security/azure-authentication/" class="md-nav__link">
        Authentication with Microsoft Azure
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" data-md-state="indeterminate" type="checkbox" id="__nav_7" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../operations/">Operations</a>
          
            <label for="__nav_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Operations" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Operations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/health/" class="md-nav__link">
        Health
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/discovery/" class="md-nav__link">
        Discovery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/performance/" class="md-nav__link">
        Performance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/system/" class="md-nav__link">
        System
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operations/integrations/" class="md-nav__link">
        Integrations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8">
          Walkthroughs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Walkthroughs" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Walkthroughs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Deploying Promitor, Prometheus, and Grafana on an AKS Cluster
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Deploying Promitor, Prometheus, and Grafana on an AKS Cluster
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-azure-infrastructure" class="md-nav__link">
    Deploy Azure Infrastructure
  </a>
  
    <nav class="md-nav" aria-label="Deploy Azure Infrastructure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-resource-group" class="md-nav__link">
    Create a Resource Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-service-principal" class="md-nav__link">
    Create a Service Principal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-service-bus-namespace-and-queue" class="md-nav__link">
    Create a Service Bus Namespace and Queue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-an-aks-cluster" class="md-nav__link">
    Create an AKS Cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-setup" class="md-nav__link">
    Cluster Setup
  </a>
  
    <nav class="md-nav" aria-label="Cluster Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-credentials" class="md-nav__link">
    Get credentials
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-promitor-and-prometheus" class="md-nav__link">
    Deploy Promitor and Prometheus
  </a>
  
    <nav class="md-nav" aria-label="Deploy Promitor and Prometheus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-metrics-declaration-for-promitor" class="md-nav__link">
    Create a metrics declaration for Promitor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-promitor-to-your-cluster-using-helm" class="md-nav__link">
    Deploy Promitor to your cluster using Helm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-prometheus" class="md-nav__link">
    Install Prometheus
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-and-check-output" class="md-nav__link">
    Test and check output
  </a>
  
    <nav class="md-nav" aria-label="Test and check output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-load-to-the-queue" class="md-nav__link">
    Add load to the queue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#see-promitor-prometheus-output-via-port-forwarding" class="md-nav__link">
    See Promitor &amp; Prometheus output via port-forwarding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualization" class="md-nav__link">
    Visualization
  </a>
  
    <nav class="md-nav" aria-label="Visualization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-grafana" class="md-nav__link">
    Install Grafana
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-prometheus-as-a-data-source" class="md-nav__link">
    Add Prometheus as a data source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-grafana-dashboard-for-queue-metrics" class="md-nav__link">
    Create a Grafana dashboard for queue metrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-kubernetes-dashboard" class="md-nav__link">
    Creating a Kubernetes dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-resources" class="md-nav__link">
    Delete resources
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../use-promitor-with-managed-identity/" class="md-nav__link">
        Using Managed Identity with Promitor on an AKS Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../migrate-from-1.x-to-2.x/" class="md-nav__link">
        Migrate from Promitor Scraper 1.x to 2.x
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-azure-infrastructure" class="md-nav__link">
    Deploy Azure Infrastructure
  </a>
  
    <nav class="md-nav" aria-label="Deploy Azure Infrastructure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-resource-group" class="md-nav__link">
    Create a Resource Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-service-principal" class="md-nav__link">
    Create a Service Principal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-service-bus-namespace-and-queue" class="md-nav__link">
    Create a Service Bus Namespace and Queue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-an-aks-cluster" class="md-nav__link">
    Create an AKS Cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-setup" class="md-nav__link">
    Cluster Setup
  </a>
  
    <nav class="md-nav" aria-label="Cluster Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-credentials" class="md-nav__link">
    Get credentials
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-promitor-and-prometheus" class="md-nav__link">
    Deploy Promitor and Prometheus
  </a>
  
    <nav class="md-nav" aria-label="Deploy Promitor and Prometheus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-metrics-declaration-for-promitor" class="md-nav__link">
    Create a metrics declaration for Promitor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-promitor-to-your-cluster-using-helm" class="md-nav__link">
    Deploy Promitor to your cluster using Helm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-prometheus" class="md-nav__link">
    Install Prometheus
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-and-check-output" class="md-nav__link">
    Test and check output
  </a>
  
    <nav class="md-nav" aria-label="Test and check output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-load-to-the-queue" class="md-nav__link">
    Add load to the queue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#see-promitor-prometheus-output-via-port-forwarding" class="md-nav__link">
    See Promitor &amp; Prometheus output via port-forwarding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualization" class="md-nav__link">
    Visualization
  </a>
  
    <nav class="md-nav" aria-label="Visualization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-grafana" class="md-nav__link">
    Install Grafana
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-prometheus-as-a-data-source" class="md-nav__link">
    Add Prometheus as a data source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-grafana-dashboard-for-queue-metrics" class="md-nav__link">
    Create a Grafana dashboard for queue metrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-kubernetes-dashboard" class="md-nav__link">
    Creating a Kubernetes dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-resources" class="md-nav__link">
    Delete resources
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/promitor/docs/edit/main/docs/walkthroughs/scrape-promitor-with-prometheus-on-azure-kubernetes-service.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="deploying-promitor-prometheus-and-grafana-on-an-aks-cluster">Deploying Promitor, Prometheus, and Grafana on an AKS Cluster<a class="headerlink" href="#deploying-promitor-prometheus-and-grafana-on-an-aks-cluster" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>In this walkthrough, we'll set up a basic monitoring solution with Promitor,
Prometheus, and Grafana.</p>
<p>In order to have a resource to monitor, we'll create a Service Bus queue and add
load to the queue with Service Bus Explorer.</p>
<p>We'll deploy Promitor, Prometheus, and Grafana to a Kubernetes cluster using Helm,
and explain how each of these services connects and how to see output.</p>
<p>We'll also walk through setting up basic Grafana dashboard to visualize the metrics
we're monitoring.</p>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><a href="#deploy-azure-infrastructure">Deploy Azure Infrastructure</a></strong><ul>
<li><a href="#create-a-resource-group">Create a Resource Group</a></li>
<li><a href="#create-a-service-principal">Create a Service Principal</a></li>
<li><a href="#create-a-service-bus-namespace-and-queue">Create a Service Bus Namespace and Queue</a></li>
<li><a href="#create-an-aks-cluster">Create an AKS Cluster</a></li>
</ul>
</li>
<li><strong><a href="#cluster-setup">Cluster Setup</a></strong><ul>
<li><a href="#get-credentials">Get credentials</a></li>
</ul>
</li>
<li><strong><a href="#deploy-promitor-and-prometheus">Deploy Promitor and Prometheus</a></strong><ul>
<li><a href="#create-a-metrics-declaration-for-promitor">Create a metrics declaration for Promitor</a></li>
<li><a href="#deploy-promitor-to-your-cluster-using-helm">Deploy Promitor to your cluster using Helm</a></li>
<li><a href="#install-prometheus">Install Prometheus</a></li>
</ul>
</li>
<li><strong><a href="#test-and-check-output">Test and check output</a></strong><ul>
<li><a href="#add-load-to-the-queue">Add load to the queue</a></li>
<li><a href="#see-promitor-prometheus-output-via-port-forwarding">See Promitor &amp; Prometheus output via port-forwarding</a></li>
</ul>
</li>
<li><strong><a href="#visualization">Visualization</a></strong><ul>
<li><a href="#install-grafana">Install Grafana</a></li>
<li><a href="#add-prometheus-as-a-data-source">Add Prometheus as a data source</a></li>
<li><a href="#create-a-grafana-dashboard-for-queue-metrics">Create a Grafana dashboard for queue metrics</a></li>
<li><a href="#creating-a-kubernetes-dashboard">Creating a Kubernetes dashboard</a></li>
</ul>
</li>
<li><strong><a href="#delete-resources">Delete resources</a></strong></li>
</ul>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>The <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Azure CLI</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl</a>, the Kubernetes
  command-line tool. It can also be installed via the Azure CLI with <code>az aks install-cli</code>.</li>
<li><a href="https://helm.sh/docs/using_helm/#installing-the-helm-client">Helm</a>, a Kubernetes
  deployment manager</li>
<li><a href="https://github.com/paolosalvatori/ServiceBusExplorer/releases">Service Bus Explorer</a></li>
</ul>
<h2 id="deploy-azure-infrastructure">Deploy Azure Infrastructure<a class="headerlink" href="#deploy-azure-infrastructure" title="Permanent link">&para;</a></h2>
<h3 id="create-a-resource-group">Create a Resource Group<a class="headerlink" href="#create-a-resource-group" title="Permanent link">&para;</a></h3>
<pre><code class="language-bash">az group create --name PromitorRG --location eastus
</code></pre>
<p>Output:</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;/subscriptions/&lt;guid-subscription-id&gt;/resourceGroups/PromitorRG&quot;,
  &quot;...&quot;: &quot;...&quot;
}
</code></pre>
<h3 id="create-a-service-principal">Create a Service Principal<a class="headerlink" href="#create-a-service-principal" title="Permanent link">&para;</a></h3>
<p>Use the resource group creation output to add a scope to your service principal:</p>
<pre><code class="language-bash">az ad sp create-for-rbac \
  --role=&quot;Monitoring Reader&quot; \
  --scopes=&quot;/subscriptions/&lt;guid-subscription-id&gt;/resourceGroups/PromitorRG&quot;
</code></pre>
<p>Which should output something similar to</p>
<pre><code class="language-json">{
  &quot;appId&quot;: &quot;&lt;guid-sp-app-id&gt;&quot;,
  &quot;displayName&quot;: &quot;azure-cli-2019-03-29-19-21-58&quot;,
  &quot;name&quot;: &quot;http://azure-cli-2019-03-29-19-21-58&quot;,
  &quot;password&quot;: &quot;&lt;guid-sp-generated-password&gt;&quot;,
  &quot;tenant&quot;: &quot;&lt;guid-tenant-id&gt;&quot;
}
</code></pre>
<p>Save this output as we will use the app ID, tenant ID, and password later on.</p>
<h3 id="create-a-service-bus-namespace-and-queue">Create a Service Bus Namespace and Queue<a class="headerlink" href="#create-a-service-bus-namespace-and-queue" title="Permanent link">&para;</a></h3>
<p>First we'll need to create a namespace. Service Bus Namespaces need to be globally
unique, so we won't use a default name in these commands.</p>
<pre><code class="language-bash">az servicebus namespace create \
  --resource-group PromitorRG \
  --name &lt;service-bus-namespace&gt; \
  --location eastus
</code></pre>
<p>We'll then create a queue in that namespace:</p>
<pre><code class="language-bash">az servicebus queue create \
  --resource-group PromitorRG \
  --namespace-name &lt;service-bus-namespace&gt; \
  --name demo_queue
</code></pre>
<p>Finally, get the connection string for this Service Bus namespace for use later.</p>
<pre><code class="language-bash">az servicebus namespace authorization-rule keys list \
  --resource-group PromitorRG \
  --namespace-name &lt;service-bus-namespace&gt; \
  --name RootManageSharedAccessKey \
  --query primaryConnectionString \
  --output tsv
</code></pre>
<h3 id="create-an-aks-cluster">Create an AKS Cluster<a class="headerlink" href="#create-an-aks-cluster" title="Permanent link">&para;</a></h3>
<p>Create a cluster with:</p>
<pre><code class="language-bash">az aks create \
  --name PromitorCluster \
  --resource-group PromitorRG \
  --node-count 1 \
  --generate-ssh-keys
</code></pre>
<h2 id="cluster-setup">Cluster Setup<a class="headerlink" href="#cluster-setup" title="Permanent link">&para;</a></h2>
<h3 id="get-credentials">Get credentials<a class="headerlink" href="#get-credentials" title="Permanent link">&para;</a></h3>
<p>You can get your cluster's credentials with</p>
<pre><code class="language-bash">az aks get-credentials \
  --name PromitorCluster \
  --resource-group PromitorRG
</code></pre>
<p>This will save these credentials to your kubeconfig file and set your new cluster
as your current context for all <code>kubectl</code> commands.</p>
<p>Verify your credentials and check that your cluster is up and running with
<code>kubectl get nodes</code>.</p>
<h2 id="deploy-promitor-and-prometheus">Deploy Promitor and Prometheus<a class="headerlink" href="#deploy-promitor-and-prometheus" title="Permanent link">&para;</a></h2>
<h3 id="create-a-metrics-declaration-for-promitor">Create a metrics declaration for Promitor<a class="headerlink" href="#create-a-metrics-declaration-for-promitor" title="Permanent link">&para;</a></h3>
<p>Before deploying Promitor, you'll need a values file with secrets &amp; a metric declaration
file (these can also be the same file for ease of use). The yaml below will scrape
one metric, queue length, from the queue created above.</p>
<pre><code class="language-yaml">azureAuthentication:
  appId: &lt;guid-sp-app-id&gt;
  appKey: &lt;guid-sp-generated-password&gt;

azureMetadata:
  tenantId: &lt;guid-tenant-id&gt;
  subscriptionId: &lt;guid-subscription-id&gt;
  resourceGroupName: PromitorRG
metricDefaults:
  aggregation:
    interval: 00:05:00
  scraping:
    schedule: &quot;* * * * *&quot;
metrics:
  - name: demo_queue_size
    description: &quot;Amount of active messages of the 'demo_queue' queue&quot;
    resourceType: ServiceBusNamespace
    azureMetricConfiguration:
      metricName: ActiveMessages
      aggregation:
        type: Total
    resources:
      - namespace: &lt;service-bus-namespace&gt;
        queueName: demo_queue
</code></pre>
<h3 id="deploy-promitor-to-your-cluster-using-helm">Deploy Promitor to your cluster using Helm<a class="headerlink" href="#deploy-promitor-to-your-cluster-using-helm" title="Permanent link">&para;</a></h3>
<p>To deploy, we'll first add the Promitor chart repository to helm:</p>
<pre><code class="language-bash">helm repo add promitor https://charts.promitor.io/
helm repo update
</code></pre>
<p>With this repository added, we can deploy Promitor:</p>
<pre><code class="language-bash">helm install promitor-agent-scraper promitor/promitor-agent-scraper \
  --values your/path/to/metric-declaration.yaml
</code></pre>
<h3 id="install-prometheus">Install Prometheus<a class="headerlink" href="#install-prometheus" title="Permanent link">&para;</a></h3>
<p><strong>Note: If you're seeing errors installing Prometheus or Grafana from the Helm</strong>
<strong>chart repository, make sure you run <code>helm repo update</code> before digging into the</strong>
<strong>errors more. You might have an outdated copy of the chart.</strong></p>
<p>Running the deployment command from the previous section should give you an output
that includes a script similar to this one:</p>
<pre><code class="language-bash">cat &gt; promitor-scrape-config.yaml &lt;&lt;EOF
extraScrapeConfigs: |
  - job_name: promitor-agent-scraper
    metrics_path: /metrics
    static_configs:
      - targets:
        - promitor-agent-scraper.default.svc.cluster.local:80
EOF
helm install stable/prometheus -f promitor-scrape-config.yaml
</code></pre>
<p>You can see this output again at any time by running <code>helm status promitor-agent-scraper</code>.</p>
<p>Running these commands will create a Prometheus scraping configuration file in your
current directory and deploy Prometheus to your cluster with that scraping configuration
in addition to the default.</p>
<h2 id="test-and-check-output">Test and check output<a class="headerlink" href="#test-and-check-output" title="Permanent link">&para;</a></h2>
<h3 id="add-load-to-the-queue">Add load to the queue<a class="headerlink" href="#add-load-to-the-queue" title="Permanent link">&para;</a></h3>
<p>Now we'll use Service Bus Explorer to add load to our Service Bus queue so there
are meaningful metrics for Promitor to pick up.</p>
<p>In Service Bus Explorer, you can connect to your namespace &amp; queue using a connection
string. From there, right clicking on the queue in the side-bar should give you
an option to 'Send Message' - from there, use the 'Sender' tab of that window to
send bulk messages. Remember how many you send - you should see that number in the
Promitor &amp; Prometheus output.</p>
<h3 id="see-promitor-prometheus-output-via-port-forwarding">See Promitor &amp; Prometheus output via port-forwarding<a class="headerlink" href="#see-promitor-prometheus-output-via-port-forwarding" title="Permanent link">&para;</a></h3>
<p>Going back to your cluster, you should be able to see all Promitor &amp; Prometheus
pods up and running with <code>kubectl get pods</code>.</p>
<p>You can also see the services which provide a stable endpoint at which to reach
the pods by running <code>kubectl get services</code>.</p>
<p>This should give you a list with output similar to:</p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>TYPE</th>
<th>CLUSTER-IP</th>
<th>EXTERNAL-IP</th>
<th>PORT(S)</th>
</tr>
</thead>
<tbody>
<tr>
<td>promitor-agent-scraper</td>
<td>ClusterIP</td>
<td>10.0.#.#</td>
<td>\&lt;none></td>
<td>80/TCP</td>
</tr>
<tr>
<td>\&lt;prometheus-release-name>-prometheus-server</td>
<td>ClusterIP</td>
<td>10.0.#.#</td>
<td>\&lt;none></td>
<td>80/TCP</td>
</tr>
</tbody>
</table>
<p>Next to that, it should also list other services deployed by Prometheus.</p>
<p>Let's first look at the Promitor output!</p>
<p>Run <code>kubectl port-forward svc/promitor-agent-scraper 8080:80</code> and check
<a href="http://localhost:8080/metrics">http://localhost:8080/metrics</a>. You should see some information about your queue:</p>
<pre><code class="language-bash"># HELP promitor_ratelimit_arm Indication how many calls are still available before Azure Resource Manager is going to throttle us.
# TYPE promitor_ratelimit_arm gauge
promitor_ratelimit_arm{tenant_id=&lt;guid-tenant-id&gt;,subscription_id=&lt;guid-subscription-id&gt;,app_id=&lt;guid-sp-app-id&gt;} 11998 1558116465529
# HELP demo_queue_size Amount of active messages of the 'demo_queue' queue
# TYPE demo_queue_size gauge
demo_queue_size 200 1558116465677
</code></pre>
<p>where 200 is the number of messages sent.</p>
<p>We can also look at the Prometheus server and check that it's pulling in metrics
from Promitor.</p>
<p>Cancel the previous port-forward command and run
<code>kubectl port-forward svc/&lt;prometheus-release-name&gt;-prometheus-server 8080:80</code>.</p>
<p>Now, if you check <a href="http://localhost:8080">http://localhost:8080</a>, you should be able to enter Prometheus
queries.</p>
<p>Query <code>demo_queue_size</code> and as long as all your pods are up and running and both
Promitor and Prometheus have scraped metrics at least once, you should see a value
that matches the number of messages in your queue.</p>
<h2 id="visualization">Visualization<a class="headerlink" href="#visualization" title="Permanent link">&para;</a></h2>
<h3 id="install-grafana">Install Grafana<a class="headerlink" href="#install-grafana" title="Permanent link">&para;</a></h3>
<p>Grafana's chart has a few default values you may not want long term - persistant
storage is disabled and admin username/password is randomly generated - but for
our sample the out-of-the-box install will work.</p>
<p>Run <code>helm install grafana stable/grafana</code> and you should see output that
includes this command:</p>
<pre><code class="language-shell">kubectl get secret --namespace default grafana -o jsonpath=&quot;{.data.admin-password}&quot; | base64 --decode ; echo
</code></pre>
<p>Run this to get your Grafana password.</p>
<p>Now you can use <code>kubectl port-forward</code> again to log in to your Grafana dashboard.
<code>kubectl port-forward svc/grafana 8080:80</code> will make your dashboard available at
<a href="http://localhost:8080">http://localhost:8080</a>, and you can log in with username 'admin' and the password
you retrieved.</p>
<h3 id="add-prometheus-as-a-data-source">Add Prometheus as a data source<a class="headerlink" href="#add-prometheus-as-a-data-source" title="Permanent link">&para;</a></h3>
<p>After logging in, you should see an option to "Add a Data Source." Click that,
and choose the Prometheus source type (if it's not immediately visible, search
for it).</p>
<p>The only setting you should need to edit here is the URL, under the HTTP section.
Within your cluster, <code>http://&lt;prometheus-release-name&gt;-prometheus-server.default.svc.cluster.local</code>
should resolve to the Prometheus server service. (Default in that URL refers to
the namespace - if you installed in a namespace other than default, change that.)</p>
<p>Set your service's name as the Prometheus URL in Grafana, and save the data source.
It should tell you that the data source is working.</p>
<h3 id="create-a-grafana-dashboard-for-queue-metrics">Create a Grafana dashboard for queue metrics<a class="headerlink" href="#create-a-grafana-dashboard-for-queue-metrics" title="Permanent link">&para;</a></h3>
<p>First, we'll make a basic dashboard with the metric we set up in Promitor. Then
you can use a pre-built dashboard to show Prometheus' default Kubernetes metrics.</p>
<p>Go to the + button on the sidebar, and choose "Dashboard". To make a simple graph
showing your queue size, you can write <code>demo_queue_size</code> in the query field. Click
out of that input field and the graph should update.</p>
<p>To see more, you can go back to Service Bus Explorer and send or receive messages.
Your Grafana graph won't update immediately, but you should see results in a few
minutes.</p>
<p>In order to see results without manually refreshing, find the dropdown menu in
the top right corner that sets the time range of the graph. Here you can edit time
range and refresh rate.</p>
<p>Make sure to save your new dashboard before exiting the page.</p>
<h3 id="creating-a-kubernetes-dashboard">Creating a Kubernetes dashboard<a class="headerlink" href="#creating-a-kubernetes-dashboard" title="Permanent link">&para;</a></h3>
<p>Now we'll import a pre-created dashboard that shows Kubernetes metrics. There are
multiple available on Grafana Lab's dashboard site - try <a href="https://grafana.com/dashboards/6417">6417</a>.</p>
<p>To import a dashboard, click the + button on the sidebar and choose "Import." From
there, you can either load a JSON file or enter the dashbord ID: 6417.</p>
<p>Click "Load" and you will be given some configuration options. The only one that
needs to be set is the Prometheus data source. From there, you should be able to
create the dashboard and view metrics about your AKS cluster.</p>
<h2 id="delete-resources">Delete resources<a class="headerlink" href="#delete-resources" title="Permanent link">&para;</a></h2>
<p>To delete all the resources used in this tutorial, run <code>az group delete --name PromitorRG</code>.</p>
<p><a href="/">&larr; back</a></p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../operations/integrations/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Integrations" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Integrations
            </div>
          </div>
        </a>
      
      
        
        <a href="../use-promitor-with-managed-identity/" class="md-footer__link md-footer__link--next" aria-label="Next: Using Managed Identity with Promitor on an AKS Cluster" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Using Managed Identity with Promitor on an AKS Cluster
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2018 - 2021 Tom Kerkhove
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/tomkerkhove?tab=packages&repo_name=promitor" target="_blank" rel="noopener" title="Container Registry" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    <a href="https://github.com/promitor/docs" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    <a href="https://twitter.com/promitorio" target="_blank" rel="noopener" title="Follow us on Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    <a href="https://github.com/sponsors/promitor" target="_blank" rel="noopener" title="Sponsor Promitor" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M0 190.9v-5.8c0-69.9 50.52-129.52 119.4-141 44.7-7.59 92 7.27 124.6 39.92L256 96l11.1-11.98C300.6 51.37 347 36.51 392.6 44.1c68.9 11.48 119.4 71.1 119.4 141v5.8c0 41.5-17.2 81.2-47.6 109.5L283.7 469.1c-7.5 7-17.4 10.9-27.7 10.9s-20.2-3.9-27.7-10.9L47.59 300.4C17.23 272.1 0 232.4 0 190.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.indexes", "navigation.sections", "navigation.tabs.sticky", "navigation.tabs", "navigation.top", "navigation.tracking", "toc.follow", "content.code.annotate", "content.tabs.link", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6e54b5cd.min.js"></script>
      
    
  </body>
</html>